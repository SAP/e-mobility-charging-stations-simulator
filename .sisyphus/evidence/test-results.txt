
> e-mobility-charging-stations-simulator@2.3.1 test /Users/I339261/SAPDevelop/e-mobility-charging-stations-simulator-git-worktrees/feat-certs-management
> c8 node --import tsx --test tests/**/*.test.ts -- tests/charging-station/ocpp/2.0/OCPP20CertificateManager.test.ts

2/19/2026, 8:38:59 PM Simulator configuration | Configuration file './src/assets/config.json' not found, using default configuration
▶ ConfigurationKeyUtils test suite
  ▶ getConfigurationKey()
    ✔ returns undefined when configurationKey array is missing (1.079791ms)
    ✔ finds existing key (case-sensitive) (0.221333ms)
    ✔ respects case sensitivity (no match) (0.075625ms)
    ✔ supports caseInsensitive lookup (0.080416ms)
  ✔ getConfigurationKey() (1.989583ms)
  ▶ addConfigurationKey()
    ✔ no-op when configurationKey array missing (0.145209ms)
    ✔ adds new key with default options (0.127917ms)
    ✔ adds new key with custom options (0.095ms)
    ✔ logs error and does not overwrite value when key exists and overwrite=false (1.443875ms)
    ✔ logs error and leaves key untouched when identical options & value attempted (overwrite=false) (0.19225ms)
    ✔ overwrites existing key value and options when overwrite=true (0.084791ms)
    ✔ caseInsensitive overwrite updates existing differently cased key (0.068792ms)
    ✔ case-insensitive false creates separate key with different case (0.067334ms)
    ✔ calls saveOcppConfiguration when params.save=true (new key) (0.072875ms)
    ✔ calls saveOcppConfiguration when overwriting existing key and save=true (0.094208ms)
  ✔ addConfigurationKey() (2.626042ms)
  ▶ setConfigurationKeyValue()
    ✔ returns undefined and logs error for non-existing key (0.267625ms)
    ✔ returns undefined without logging when configurationKey array missing (0.154958ms)
    ✔ updates existing key value and saves (0.117792ms)
    ✔ caseInsensitive value update works (0.071041ms)
  ✔ setConfigurationKeyValue() (0.740625ms)
  ▶ deleteConfigurationKey()
    ✔ returns undefined when configurationKey array missing (0.112709ms)
    ✔ returns undefined when key does not exist (0.05525ms)
    ✔ deletes existing key and saves by default (0.14025ms)
    ✔ does not save when params.save=false (0.071917ms)
    ✔ caseInsensitive deletion removes key with different case (0.0555ms)
  ✔ deleteConfigurationKey() (0.515291ms)
  ▶ Combined scenarios
    ✔ add then set then delete lifecycle (0.070625ms)
  ✔ Combined scenarios (0.105166ms)
✔ ConfigurationKeyUtils test suite (6.318666ms)
2/19/2026, 8:38:59 PM Simulator configuration | Configuration file './src/assets/config.json' not found, using default configuration
▶ Helpers test suite
  ✔ Verify getChargingStationId() (0.841958ms)
  ✔ Verify getHashId() (0.128292ms)
  ✔ Verify validateStationInfo() - Missing stationInfo (0.639583ms)
  ✔ Verify validateStationInfo() - Empty stationInfo (0.123375ms)
  ✔ Verify validateStationInfo() - Missing chargingStationId (0.084792ms)
  ✔ Verify validateStationInfo() - Empty chargingStationId (0.175125ms)
  ✔ Verify validateStationInfo() - Missing hashId (0.21425ms)
  ✔ Verify validateStationInfo() - Empty hashId (0.114667ms)
  ✔ Verify validateStationInfo() - Missing templateIndex (0.151708ms)
  ✔ Verify validateStationInfo() - Invalid templateIndex (zero) (0.099333ms)
  ✔ Verify validateStationInfo() - Missing templateName (0.106875ms)
  ✔ Verify validateStationInfo() - Empty templateName (0.080291ms)
  ✔ Verify validateStationInfo() - Missing maximumPower (0.089208ms)
  ✔ Verify validateStationInfo() - Invalid maximumPower (zero) (0.080083ms)
  ✔ Verify validateStationInfo() - Missing maximumAmperage (0.082166ms)
  ✔ Verify validateStationInfo() - Invalid maximumAmperage (zero) (0.110375ms)
  ✔ Verify validateStationInfo() - Valid configuration passes (0.104541ms)
  ✔ Verify validateStationInfo() - OCPP 2.0 requires EVSE (0.107917ms)
  ✔ Verify validateStationInfo() - OCPP 2.0.1 requires EVSE (0.095542ms)
  ✔ Verify checkChargingStationState() - Not started or starting (1.2945ms)
  ✔ Verify checkChargingStationState() - Starting returns true (0.071708ms)
  ✔ Verify checkChargingStationState() - Started returns true (0.067041ms)
  ✔ Verify getPhaseRotationValue() (0.121166ms)
  ✔ Verify getMaxNumberOfEvses() (0.046125ms)
  ✔ Verify checkTemplate() (0.346375ms)
  ✔ Verify checkConfiguration() (0.241042ms)
  ✔ Verify checkStationInfoConnectorStatus() (0.125917ms)
  ✔ Verify getBootConnectorStatus() - default to Available when no bootStatus (0.214791ms)
  ✔ Verify getBootConnectorStatus() - use bootStatus from template (0.069208ms)
  ✔ Verify getBootConnectorStatus() - charging station unavailable overrides bootStatus (0.070084ms)
  ✔ Verify getBootConnectorStatus() - connector unavailable overrides bootStatus (0.064375ms)
  ✔ Verify getBootConnectorStatus() - transaction in progress restores previous status (0.065ms)
  ✔ Verify getBootConnectorStatus() - no transaction uses bootStatus over previous status (0.059875ms)
✔ Helpers test suite (7.357959ms)
▶ OCPP20CertificateManager
  ▶ storeCertificate
    ✖ Should store a valid PEM certificate to the correct path (18.091792ms)
    ✔ Should reject invalid PEM certificate without BEGIN/END markers (0.151916ms)
    ✔ Should reject empty certificate data (0.078875ms)
    ✔ Should create certificate directory structure if not exists (13.562458ms)
  ✖ storeCertificate (32.49725ms)
  ▶ deleteCertificate
    ✔ Should delete certificate by hash data (4.383167ms)
    ✔ Should return NotFound for non-existent certificate (0.647333ms)
    ✔ Should handle filesystem errors gracefully (0.149208ms)
  ✔ deleteCertificate (5.306416ms)
  ▶ getInstalledCertificates
    ✔ Should return list of installed certificates for station (1.635125ms)
    ✔ Should filter certificates by type when filter provided (0.779209ms)
    ✔ Should return empty list when no certificates installed (0.136167ms)
    ✔ Should support multiple certificate type filters (1.015459ms)
  ✔ getInstalledCertificates (3.713542ms)
  ▶ computeCertificateHash
    ✔ Should compute hash data for valid PEM certificate (0.20025ms)
    ✔ Should return hex-encoded hash values (0.195916ms)
    ✔ Should throw error for invalid PEM certificate (0.183ms)
    ✔ Should throw error for empty certificate (0.059917ms)
    ✔ Should support SHA384 hash algorithm (0.106041ms)
    ✔ Should support SHA512 hash algorithm (0.085666ms)
  ✔ computeCertificateHash (0.948958ms)
  ▶ validateCertificateFormat
    ✔ Should return true for valid PEM certificate (0.077ms)
    ✔ Should return false for certificate without BEGIN marker (0.037ms)
    ✔ Should return false for certificate with wrong markers (0.050125ms)
    ✔ Should return false for empty string (0.03625ms)
    ✔ Should return false for null/undefined input (0.042875ms)
    ✔ Should return true for certificate with extra whitespace (0.036792ms)
  ✔ validateCertificateFormat (0.36975ms)
  ▶ getCertificatePath
    ✖ Should return correct file path for certificate (0.135875ms)
    ✖ Should handle special characters in serial number (0.097292ms)
    ✔ Should return different paths for different certificate types (0.072833ms)
    ✖ Should return path following project convention (0.071791ms)
  ✖ getCertificatePath (0.447584ms)
  ▶ Edge cases and error handling
    ✔ Should handle concurrent certificate operations (1.809167ms)
    ✔ Should handle very long certificate chains (0.383875ms)
    ✔ Should sanitize station hash ID for filesystem safety (0.0975ms)
  ✔ Edge cases and error handling (2.369458ms)
✖ OCPP20CertificateManager (46.291667ms)
▶ BaseError test suite
  ✔ Verify that BaseError can be instantiated (1.460625ms)
  ✔ Verify that BaseError can be instantiated with a message (0.082334ms)
✔ BaseError test suite (2.128125ms)
2/19/2026, 8:38:59 PM Simulator configuration | Configuration file './src/assets/config.json' not found, using default configuration
▶ OCPPError test suite
  ✔ Verify that OCPPError can be instantiated (1.153291ms)
✔ OCPPError test suite (1.731667ms)
▶ ConfigurationData test suite
  ✔ Verify ConfigurationSection enumeration (0.6185ms)
  ✔ Verify SupervisionUrlDistribution enumeration (0.075792ms)
  ✔ Verify ApplicationProtocolVersion enumeration (0.058167ms)
✔ ConfigurationData test suite (1.357667ms)
▶ AsyncLock test suite
  ✔ Verify runExclusive() on sync fn (1.381333ms)
  ✔ Verify runExclusive() on async fn (0.2125ms)
✔ AsyncLock test suite (2.477333ms)
log prefix | authorization file path/to/module.js not found:  Error
    at TestContext.<anonymous> (/Users/I339261/SAPDevelop/e-mobility-charging-stations-simulator-git-worktrees/feat-certs-management/tests/utils/ConfigurationUtils.test.ts:43:19)
    at Test.runInAsyncScope (node:async_hooks:214:14)
    at Test.run (node:internal/test_runner/test:1103:25)
    at Suite.processPendingSubtests (node:internal/test_runner/test:785:18)
    at Test.postRun (node:internal/test_runner/test:1232:19)
    at Test.run (node:internal/test_runner/test:1160:12)
    at async Suite.processPendingSubtests (node:internal/test_runner/test:785:7) {
  code: 'ENOENT'
}
▶ ConfigurationUtils test suite
  ✔ Verify logPrefix() (16.226ms)
  ✔ Verify buildPerformanceUriFilePath() (0.245417ms)
  ✔ Verify getDefaultPerformanceStorageUri() (0.315875ms)
  ✔ Verify handleFileException() (2.005792ms)
  ✔ Verify checkWorkerElementsPerWorker() (0.208125ms)
✔ ConfigurationUtils test suite (19.753958ms)
▶ ElectricUtils test suite
  ✔ Verify DCElectricUtils.power() (0.66025ms)
  ✔ Verify DCElectricUtils.amperage() (0.082708ms)
  ✔ Verify ACElectricUtils.powerTotal() (0.077792ms)
  ✔ Verify ACElectricUtils.powerPerPhase() (0.06325ms)
  ✔ Verify ACElectricUtils.amperageTotal() (0.062125ms)
  ✔ Verify ACElectricUtils.amperageTotalFromPower() (0.064792ms)
  ✔ Verify ACElectricUtils.amperagePerPhaseFromPower() (0.065083ms)
✔ ElectricUtils test suite (1.741833ms)
2/19/2026, 8:38:59 PM Simulator configuration | Configuration file './src/assets/config.json' not found, using default configuration
log prefix | authorization file path/to/module.js not found:  Error
    at TestContext.<anonymous> (/Users/I339261/SAPDevelop/e-mobility-charging-stations-simulator-git-worktrees/feat-certs-management/tests/utils/ErrorUtils.test.ts:27:19)
    at Test.runInAsyncScope (node:async_hooks:214:14)
    at Test.run (node:internal/test_runner/test:1103:25)
    at Test.start (node:internal/test_runner/test:1000:17)
    at node:internal/test_runner/test:1513:71
    at node:internal/per_context/primordials:466:82
    at new Promise (<anonymous>)
    at new SafePromise (node:internal/per_context/primordials:435:3)
    at node:internal/per_context/primordials:466:9
    at Array.map (<anonymous>) {
  code: 'ENOENT'
}
log prefix | authorization file path/to/module.js not found:  Error
    at TestContext.<anonymous> (/Users/I339261/SAPDevelop/e-mobility-charging-stations-simulator-git-worktrees/feat-certs-management/tests/utils/ErrorUtils.test.ts:27:19)
    at Test.runInAsyncScope (node:async_hooks:214:14)
    at Test.run (node:internal/test_runner/test:1103:25)
    at Test.start (node:internal/test_runner/test:1000:17)
    at node:internal/test_runner/test:1513:71
    at node:internal/per_context/primordials:466:82
    at new Promise (<anonymous>)
    at new SafePromise (node:internal/per_context/primordials:435:3)
    at node:internal/per_context/primordials:466:9
    at Array.map (<anonymous>) {
  code: 'ENOENT'
}
▶ ErrorUtils test suite
  ✔ Verify handleFileException() (3.557667ms)
  ✔ Verify handleSendMessageError() (0.444459ms)
  ✔ Verify handleIncomingRequestError() (0.78475ms)
✔ ErrorUtils test suite (5.437709ms)
▶ StatisticUtils test suite
  ✔ Verify average() (1.524625ms)
  ✔ Verify median() (0.148667ms)
  ✔ Verify min() (0.094708ms)
  ✔ Verify max() (0.076041ms)
  ✔ Verify percentile() (0.150584ms)
  ✔ Verify std() (0.080916ms)
✔ StatisticUtils test suite (2.771791ms)
▶ Utils test suite
  ✔ Verify generateUUID()/validateUUID() (1.595125ms)
  ✔ Verify sleep() (12.44875ms)
  ✔ Verify formatDurationMilliSeconds() (0.491125ms)
  ✔ Verify formatDurationSeconds() (0.099542ms)
  ✔ Verify isValidDate() (0.080958ms)
  ✔ Verify convertToDate() (0.416709ms)
  ✔ Verify convertToInt() (0.202667ms)
  ✔ Verify convertToFloat() (0.186ms)
  ✔ Verify convertToBoolean() (0.089583ms)
  ✔ Verify secureRandom() (0.582917ms)
  ✔ Verify roundTo() (0.118833ms)
  ✔ Verify getRandomFloat() (0.187458ms)
  ✔ Verify extractTimeSeriesValues() (0.233667ms)
  ✔ Verify isAsyncFunction() (0.274167ms)
  ✔ Verify clone() (2.00175ms)
  ✔ Verify once() (0.101333ms)
  ✔ Verify has() (0.086666ms)
  ✔ Verify isEmpty() (0.124625ms)
  ✔ Verify isNotEmptyString() (0.081375ms)
  ✔ Verify isNotEmptyArray() (0.157333ms)
  ✔ Verify insertAt() (0.06425ms)
  ✔ Verify convertToIntOrNaN() (0.087458ms)
  ✔ Verify isArraySorted() (0.08975ms)
  ✔ Verify clampToSafeTimerValue() (0.05975ms)
✔ Utils test suite (20.839541ms)
▶ WorkerUtils test suite
  ✔ Verify checkWorkerProcessType() (0.742834ms)
Worker exited successfully
Worker terminated successfully
Worker exited with exit code: 2
Worker exited with exit code: 5
Worker errored:  Error: Test error message
    at TestContext.<anonymous> (/Users/I339261/SAPDevelop/e-mobility-charging-stations-simulator-git-worktrees/feat-certs-management/tests/worker/WorkerUtils.test.ts:87:23)
    at Test.runInAsyncScope (node:async_hooks:214:14)
    at Test.run (node:internal/test_runner/test:1103:25)
    at Suite.processPendingS